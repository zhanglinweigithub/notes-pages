import{_ as s,o as a,c as n,a as i}from"./app-Vg0IViah.js";const e="/notes-pages/assets/image-20210723173057733-CFESkWca.png",l="/notes-pages/assets/image-20210723173215728-wUZwoMgY.png",D={},r=i(`<h1 id="聚合-java" tabindex="-1"><a class="header-anchor" href="#聚合-java"><span>聚合-Java</span></a></h1><p>聚合常见的有三类：</p><ul><li><strong>桶（Bucket）</strong> 聚合：用来对文档做分组，相当于 <code>MySql</code>的<code>group by</code></li><li><code>TermAggregation</code>：按照文档字段值分组</li><li><code>Date Histogram</code>：按照日期阶梯分组，例如一周为一组，或者一月为一组</li><li><strong>度量（Metric）</strong> 聚合：用以计算一些值，比如：最大值、最小值、平均值等</li><li><code>Avg</code>：求平均值</li><li><code>Max</code>：求最大值</li><li><code>Min</code>：求最小值</li><li><code>Stats</code>：同时求<code>max</code>、<code>min</code>、<code>avg</code>、<code>sum</code>等</li><li><strong>管道（pipeline）</strong> 聚合：其它聚合的结果为基础做聚合</li></ul><div class="hint-container warning"><p class="hint-container-title">注意</p><p>参加聚合的字段必须是<code>keyword</code>、日期、数值、布尔类型</p></div><div class="hint-container tip"><p class="hint-container-title">提示</p><p>聚合条件与<code>query</code>条件同级别，因此需要使用<code>request.source()</code>来指定聚合条件。</p></div><h2 id="一、bucket聚合" tabindex="-1"><a class="header-anchor" href="#一、bucket聚合"><span>一、Bucket聚合</span></a></h2><h3 id="查询" tabindex="-1"><a class="header-anchor" href="#查询"><span>查询</span></a></h3><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes dark-plus dark-plus" style="background-color:#1E1E1E;--shiki-dark-bg:#1E1E1E;color:#D4D4D4;--shiki-dark:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;--shiki-dark:#6A9955;">// 准备 Request</span></span>
<span class="line"><span style="color:#4EC9B0;--shiki-dark:#4EC9B0;">SearchRequest</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;"> request</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> = </span><span style="color:#C586C0;--shiki-dark:#C586C0;">new</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;"> SearchRequest</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">(</span><span style="color:#CE9178;--shiki-dark:#CE9178;">&quot;hotel&quot;</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#6A9955;--shiki-dark:#6A9955;">// DSL</span></span>
<span class="line"><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">request</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">source</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">().</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">size</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">(</span><span style="color:#B5CEA8;--shiki-dark:#B5CEA8;">0</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">request</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">source</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">().</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">aggregation</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">(</span></span>
<span class="line"><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">	AggregationBuilders</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">terms</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">(</span><span style="color:#CE9178;--shiki-dark:#CE9178;">&quot;brandAgg&quot;</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">   					   .</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">field</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">(</span><span style="color:#CE9178;--shiki-dark:#CE9178;">&quot;brand&quot;</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">    				   .</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">size</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">(</span><span style="color:#B5CEA8;--shiki-dark:#B5CEA8;">20</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#6A9955;--shiki-dark:#6A9955;">// 发请求</span></span>
<span class="line"><span style="color:#4EC9B0;--shiki-dark:#4EC9B0;">SearchResponse</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;"> response</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> = </span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">client</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">search</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">(request, </span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">RequestOptions</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">Default</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#6A9955;--shiki-dark:#6A9955;">// 解析</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">...</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+e+`" alt="image-20210723173057733" tabindex="0" loading="lazy"><figcaption>image-20210723173057733</figcaption></figure><h3 id="解析" tabindex="-1"><a class="header-anchor" href="#解析"><span>解析</span></a></h3><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes dark-plus dark-plus" style="background-color:#1E1E1E;--shiki-dark-bg:#1E1E1E;color:#D4D4D4;--shiki-dark:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#6A9955;--shiki-dark:#6A9955;">// 解析结果</span></span>
<span class="line"><span style="color:#4EC9B0;--shiki-dark:#4EC9B0;">Aggregations</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;"> aggregations</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> = </span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">response</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">getAggregations</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#6A9955;--shiki-dark:#6A9955;">// 根据名称获取聚合结果</span></span>
<span class="line"><span style="color:#4EC9B0;--shiki-dark:#4EC9B0;">Terms</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;"> brandTerms</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> = </span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">aggregations</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">get</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">(</span><span style="color:#CE9178;--shiki-dark:#CE9178;">&quot;brandAgg&quot;</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#6A9955;--shiki-dark:#6A9955;">// 获取桶</span></span>
<span class="line"><span style="color:#4EC9B0;--shiki-dark:#4EC9B0;">List</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">&lt;</span><span style="color:#569CD6;--shiki-dark:#569CD6;">?</span><span style="color:#569CD6;--shiki-dark:#569CD6;"> extends</span><span style="color:#4EC9B0;--shiki-dark:#4EC9B0;"> Terms</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#4EC9B0;--shiki-dark:#4EC9B0;">Bucket</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">&gt; </span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">buckets</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> = </span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">brandTerms</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">getBuckets</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#6A9955;--shiki-dark:#6A9955;">// 遍历</span></span>
<span class="line"><span style="color:#C586C0;--shiki-dark:#C586C0;">for</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">(</span><span style="color:#4EC9B0;--shiki-dark:#4EC9B0;">Terms</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#4EC9B0;--shiki-dark:#4EC9B0;">Bucket</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;"> bucket</span><span style="color:#C586C0;--shiki-dark:#C586C0;"> :</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> buckets) {</span></span>
<span class="line"><span style="color:#6A9955;--shiki-dark:#6A9955;">    // 获取 key，也就是聚合的字段</span></span>
<span class="line"><span style="color:#4EC9B0;--shiki-dark:#4EC9B0;">    String</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;"> brandName</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> = </span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">bucket</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">getKeyAsString</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">    System</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">out</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">println</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">(brandName);</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+l+'" alt="image-20210723173215728" tabindex="0" loading="lazy"><figcaption>image-20210723173215728</figcaption></figure>',12),o=[r];function p(t,c){return a(),n("div",null,o)}const k=s(D,[["render",p],["__file","Aggregation-Java.html.vue"]]),C=JSON.parse('{"path":"/Use/Java/ElasticSearch/Aggregation-Java.html","title":"聚合-Java","lang":"zh-CN","frontmatter":{"order":13,"category":"使用篇"},"headers":[{"level":2,"title":"一、Bucket聚合","slug":"一、bucket聚合","link":"#一、bucket聚合","children":[{"level":3,"title":"查询","slug":"查询","link":"#查询","children":[]},{"level":3,"title":"解析","slug":"解析","link":"#解析","children":[]}]}],"git":{"createdTime":1708330205000,"updatedTime":1708873062000,"contributors":[{"name":"zhanglinwei","email":"3498729975@qq.com","commits":2}]},"readingTime":{"minutes":0.97,"words":291},"filePathRelative":"Use/Java/ElasticSearch/Aggregation-Java.md","localizedDate":"2024年2月19日"}');export{k as comp,C as data};
