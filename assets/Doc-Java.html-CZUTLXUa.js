import{_ as s,o as a,c as n,a as i}from"./app-Vg0IViah.js";const l="/notes-pages/assets/image-20210720230027240-CVH6Magt.png",D="/notes-pages/assets/image-20210720230811674-QZ3o-zG0.png",e="/notes-pages/assets/image-20210720231040875-C9QXEs-I.png",o="/notes-pages/assets/image-20210720232105943-Dt9gw85O.png",p={},r=i(`<h1 id="文档操作-java" tabindex="-1"><a class="header-anchor" href="#文档操作-java"><span>文档操作-Java</span></a></h1><h2 id="一、新增文档" tabindex="-1"><a class="header-anchor" href="#一、新增文档"><span>一、新增文档</span></a></h2><p>新增文档的<code>DSL</code>语句如下：</p><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="shiki shiki-themes dark-plus dark-plus" style="background-color:#1E1E1E;--shiki-dark-bg:#1E1E1E;color:#D4D4D4;--shiki-dark:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">POST /索引库名/_doc/</span><span style="color:#B5CEA8;--shiki-dark:#B5CEA8;">1</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">{</span></span>
<span class="line"><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">    &quot;name&quot;</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">: </span><span style="color:#CE9178;--shiki-dark:#CE9178;">&quot;Jack&quot;</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">    &quot;age&quot;</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">: </span><span style="color:#B5CEA8;--shiki-dark:#B5CEA8;">21</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes dark-plus dark-plus" style="background-color:#1E1E1E;--shiki-dark-bg:#1E1E1E;color:#D4D4D4;--shiki-dark:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">@</span><span style="color:#4EC9B0;--shiki-dark:#4EC9B0;">Test</span></span>
<span class="line"><span style="color:#4EC9B0;--shiki-dark:#4EC9B0;">void</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;"> testAddDocument</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">() throws IOException {</span></span>
<span class="line"><span style="color:#6A9955;--shiki-dark:#6A9955;">    // 1.根据id查询酒店数据</span></span>
<span class="line"><span style="color:#4EC9B0;--shiki-dark:#4EC9B0;">    Hotel</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;"> hotel</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> = </span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">hotelService</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">getById</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">(</span><span style="color:#B5CEA8;--shiki-dark:#B5CEA8;">61083L</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#6A9955;--shiki-dark:#6A9955;">    // 2.转换为文档类型</span></span>
<span class="line"><span style="color:#4EC9B0;--shiki-dark:#4EC9B0;">    HotelDoc</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;"> hotelDoc</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> = </span><span style="color:#C586C0;--shiki-dark:#C586C0;">new</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;"> HotelDoc</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">(hotel);</span></span>
<span class="line"><span style="color:#6A9955;--shiki-dark:#6A9955;">    // 3.将HotelDoc转json</span></span>
<span class="line"><span style="color:#4EC9B0;--shiki-dark:#4EC9B0;">    String</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;"> json</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> = </span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">JSON</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">toJSONString</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">(hotelDoc);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;--shiki-dark:#6A9955;">    // 1.准备Request对象</span></span>
<span class="line"><span style="color:#4EC9B0;--shiki-dark:#4EC9B0;">    IndexRequest</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;"> request</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> = </span><span style="color:#C586C0;--shiki-dark:#C586C0;">new</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;"> IndexRequest</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">(</span><span style="color:#CE9178;--shiki-dark:#CE9178;">&quot;hotel&quot;</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">).</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">id</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">(</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">hotelDoc</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">getId</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">().</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">toString</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">());</span></span>
<span class="line"><span style="color:#6A9955;--shiki-dark:#6A9955;">    // 2.准备Json文档</span></span>
<span class="line"><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">    request</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">source</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">(json, </span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">XContentType</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">JSON</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#6A9955;--shiki-dark:#6A9955;">    // 3.发送请求</span></span>
<span class="line"><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">    restHighLevelClient</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">index</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">(request, </span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">RequestOptions</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">DEFAULT</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">提示</p><p>若数据库结构与<code>ES</code>中的索引库结构一样，则可省略第二步的转换操作</p></div><figure><img src="`+l+`" alt="image-20210720231040875" tabindex="0" loading="lazy"><figcaption>image-20210720231040875</figcaption></figure><h2 id="二、查询文档" tabindex="-1"><a class="header-anchor" href="#二、查询文档"><span>二、查询文档</span></a></h2><p>查询的<code>DSL</code>语句如下：</p><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="shiki shiki-themes dark-plus dark-plus" style="background-color:#1E1E1E;--shiki-dark-bg:#1E1E1E;color:#D4D4D4;--shiki-dark:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">GET /hotel/_doc/id</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>结果是一个<code>JSON</code>，其中文档放在一个<code>_source</code>属性中，因此解析就是拿到<code>_source</code>，反序列化为<code>Java</code>对象即可。</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes dark-plus dark-plus" style="background-color:#1E1E1E;--shiki-dark-bg:#1E1E1E;color:#D4D4D4;--shiki-dark:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">@</span><span style="color:#4EC9B0;--shiki-dark:#4EC9B0;">Test</span></span>
<span class="line"><span style="color:#4EC9B0;--shiki-dark:#4EC9B0;">void</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;"> testGetDocumentById</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">() throws IOException {</span></span>
<span class="line"><span style="color:#6A9955;--shiki-dark:#6A9955;">    // 1.准备Request</span></span>
<span class="line"><span style="color:#4EC9B0;--shiki-dark:#4EC9B0;">    GetRequest</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;"> request</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> = </span><span style="color:#C586C0;--shiki-dark:#C586C0;">new</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;"> GetRequest</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">(</span><span style="color:#CE9178;--shiki-dark:#CE9178;">&quot;hotel&quot;</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">, </span><span style="color:#CE9178;--shiki-dark:#CE9178;">&quot;61083&quot;</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#6A9955;--shiki-dark:#6A9955;">    // 2.发送请求，得到响应</span></span>
<span class="line"><span style="color:#4EC9B0;--shiki-dark:#4EC9B0;">    GetResponse</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;"> response</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> = </span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">restHighLevelClient</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">get</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">(request, </span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">RequestOptions</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">DEFAULT</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#6A9955;--shiki-dark:#6A9955;">    // 3.解析响应结果</span></span>
<span class="line"><span style="color:#4EC9B0;--shiki-dark:#4EC9B0;">    String</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;"> json</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> = </span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">response</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">getSourceAsString</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4EC9B0;--shiki-dark:#4EC9B0;">    HotelDoc</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;"> hotelDoc</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> = </span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">JSON</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">parseObject</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">(json, </span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">HotelDoc</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">class</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">    System</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">out</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">println</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">(hotelDoc);</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;--shiki-dark:#6A9955;">// 输出</span></span>
<span class="line"><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">HotelDoc</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">(id=</span><span style="color:#B5CEA8;--shiki-dark:#B5CEA8;">61083</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">, name=上海滴水湖皇冠假日酒店, address=自由贸易试验区临港新片区南岛1号, price=</span><span style="color:#B5CEA8;--shiki-dark:#B5CEA8;">971</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">, score=</span><span style="color:#B5CEA8;--shiki-dark:#B5CEA8;">44</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">, brand=皇冠假日, city=上海, starName=五钻, business=滴水湖临港地区, location=</span><span style="color:#B5CEA8;--shiki-dark:#B5CEA8;">30.890867</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">, </span><span style="color:#B5CEA8;--shiki-dark:#B5CEA8;">121.937241</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">, pic=</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">xxx</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">jpg</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+D+`" alt="image-20210720231040875" tabindex="0" loading="lazy"><figcaption>image-20210720231040875</figcaption></figure><h2 id="三、删除文档" tabindex="-1"><a class="header-anchor" href="#三、删除文档"><span>三、删除文档</span></a></h2><p>删除的<code>DSL</code>为是这样的：</p><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="shiki shiki-themes dark-plus dark-plus" style="background-color:#1E1E1E;--shiki-dark-bg:#1E1E1E;color:#D4D4D4;--shiki-dark:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">DELETE /hotel/_doc/id</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>与查询相比，仅仅是请求方式从<code>DELETE</code>变成<code>GET</code></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes dark-plus dark-plus" style="background-color:#1E1E1E;--shiki-dark-bg:#1E1E1E;color:#D4D4D4;--shiki-dark:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">@</span><span style="color:#4EC9B0;--shiki-dark:#4EC9B0;">Test</span></span>
<span class="line"><span style="color:#4EC9B0;--shiki-dark:#4EC9B0;">void</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;"> testDeleteDocument</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">() throws IOException {</span></span>
<span class="line"><span style="color:#6A9955;--shiki-dark:#6A9955;">    // 1.准备Request</span></span>
<span class="line"><span style="color:#4EC9B0;--shiki-dark:#4EC9B0;">    DeleteRequest</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;"> request</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> = </span><span style="color:#C586C0;--shiki-dark:#C586C0;">new</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;"> DeleteRequest</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">(</span><span style="color:#CE9178;--shiki-dark:#CE9178;">&quot;hotel&quot;</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">, </span><span style="color:#CE9178;--shiki-dark:#CE9178;">&quot;61083&quot;</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#6A9955;--shiki-dark:#6A9955;">    // 2.发送请求</span></span>
<span class="line"><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">    restHighLevelClient</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">delete</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">(request, </span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">RequestOptions</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">DEFAULT</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="四、修改文档" tabindex="-1"><a class="header-anchor" href="#四、修改文档"><span>四、修改文档</span></a></h2><p>修改有两种方式：</p><ul><li>全量修改：直接覆盖原来的文档</li><li>增量修改：修改文档中的部分字段</li></ul><p>全量修改是覆盖原来的文档，其本质是：</p><ul><li>根据指定的<code>id</code>删除文档</li><li>新增一个相同<code>id</code>的文档</li></ul><div class="hint-container tip"><p class="hint-container-title">提示</p><p>如果根据<code>id</code>删除时，<code>id</code>不存在，第二步的新增也会执行，也就从修改变成了新增操作了</p></div><p>增量修改是只修改指定<code>id</code>匹配的文档中的部分字段</p><p>全量修改与新增的<code>API</code>完全一致，判断依据是<code>ID</code>：</p><ul><li>如果新增时，<code>ID</code>已经存在，则修改</li><li>如果新增时，<code>ID</code>不存在，则新增</li></ul><p>== 要关注增量修改 ==</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes dark-plus dark-plus" style="background-color:#1E1E1E;--shiki-dark-bg:#1E1E1E;color:#D4D4D4;--shiki-dark:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">@</span><span style="color:#4EC9B0;--shiki-dark:#4EC9B0;">Test</span></span>
<span class="line"><span style="color:#4EC9B0;--shiki-dark:#4EC9B0;">void</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;"> testUpdateDocument</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">() throws IOException {</span></span>
<span class="line"><span style="color:#6A9955;--shiki-dark:#6A9955;">    // 1.准备Request</span></span>
<span class="line"><span style="color:#4EC9B0;--shiki-dark:#4EC9B0;">    UpdateRequest</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;"> request</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> = </span><span style="color:#C586C0;--shiki-dark:#C586C0;">new</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;"> UpdateRequest</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">(</span><span style="color:#CE9178;--shiki-dark:#CE9178;">&quot;hotel&quot;</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">, </span><span style="color:#CE9178;--shiki-dark:#CE9178;">&quot;61083&quot;</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#6A9955;--shiki-dark:#6A9955;">    // 2.准备请求参数</span></span>
<span class="line"><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">    request</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">doc</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">(</span></span>
<span class="line"><span style="color:#CE9178;--shiki-dark:#CE9178;">        &quot;price&quot;</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">, </span><span style="color:#CE9178;--shiki-dark:#CE9178;">&quot;952&quot;</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">,</span></span>
<span class="line"><span style="color:#CE9178;--shiki-dark:#CE9178;">        &quot;starName&quot;</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">, </span><span style="color:#CE9178;--shiki-dark:#CE9178;">&quot;四钻&quot;</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">    );</span></span>
<span class="line"><span style="color:#6A9955;--shiki-dark:#6A9955;">    // 3.发送请求</span></span>
<span class="line"><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">    restHighLevelClient</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">update</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">(request, </span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">RequestOptions</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">DEFAULT</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+e+'" alt="image-20210720231040875" tabindex="0" loading="lazy"><figcaption>image-20210720231040875</figcaption></figure><h2 id="五、批量导入文档" tabindex="-1"><a class="header-anchor" href="#五、批量导入文档"><span>五、批量导入文档</span></a></h2><p>利用<code>BulkRequest</code>批量将数据库数据导入到索引库中。</p><ul><li><p>利用<code>mybatis-plus</code>查询酒店数据</p></li><li><p>将查询到的酒店数据（Hotel）转换为文档类型数据（HotelDoc）</p></li><li><p>利用<code>JavaRestClient</code>中的<code>BulkRequest</code>批处理，实现批量新增文档</p></li></ul><p>其本质就是将多个普通的<code>CRUD</code>请求组合在一起发送。</p><p>其中提供了一个<code>add</code>方法，用来添加其他请求：</p><figure><img src="'+o+`" alt="image-20210720232105943" tabindex="0" loading="lazy"><figcaption>image-20210720232105943</figcaption></figure><p>能添加的请求包括：</p><ul><li><code>IndexRequest</code>，也就是新增</li><li><code>UpdateRequest</code>，也就是修改</li><li><code>DeleteRequest</code>，也就是删除</li></ul><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes dark-plus dark-plus" style="background-color:#1E1E1E;--shiki-dark-bg:#1E1E1E;color:#D4D4D4;--shiki-dark:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">@</span><span style="color:#4EC9B0;--shiki-dark:#4EC9B0;">Test</span></span>
<span class="line"><span style="color:#4EC9B0;--shiki-dark:#4EC9B0;">void</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;"> testBulkRequest</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">() throws IOException {</span></span>
<span class="line"><span style="color:#6A9955;--shiki-dark:#6A9955;">    // 批量查询酒店数据</span></span>
<span class="line"><span style="color:#4EC9B0;--shiki-dark:#4EC9B0;">    List</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">&lt;</span><span style="color:#4EC9B0;--shiki-dark:#4EC9B0;">Hotel</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">&gt; </span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">hotels</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> = </span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">hotelService</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">list</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;--shiki-dark:#6A9955;">    // 1.创建Request</span></span>
<span class="line"><span style="color:#4EC9B0;--shiki-dark:#4EC9B0;">    BulkRequest</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;"> request</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> = </span><span style="color:#C586C0;--shiki-dark:#C586C0;">new</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;"> BulkRequest</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#6A9955;--shiki-dark:#6A9955;">    // 2.准备参数，添加多个新增的Request</span></span>
<span class="line"><span style="color:#C586C0;--shiki-dark:#C586C0;">    for</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> (</span><span style="color:#4EC9B0;--shiki-dark:#4EC9B0;">Hotel</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;"> hotel</span><span style="color:#C586C0;--shiki-dark:#C586C0;"> :</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> hotels) {</span></span>
<span class="line"><span style="color:#6A9955;--shiki-dark:#6A9955;">        // 2.1.转换为文档类型HotelDoc</span></span>
<span class="line"><span style="color:#4EC9B0;--shiki-dark:#4EC9B0;">        HotelDoc</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;"> hotelDoc</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> = </span><span style="color:#C586C0;--shiki-dark:#C586C0;">new</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;"> HotelDoc</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">(hotel);</span></span>
<span class="line"><span style="color:#6A9955;--shiki-dark:#6A9955;">        // 2.2.创建新增文档的Request对象</span></span>
<span class="line"><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">        request</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">add</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">(</span><span style="color:#C586C0;--shiki-dark:#C586C0;">new</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;"> IndexRequest</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">(</span><span style="color:#CE9178;--shiki-dark:#CE9178;">&quot;hotel&quot;</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">                    .</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">id</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">(</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">hotelDoc</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">getId</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">().</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">toString</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">())</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">                    .</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">source</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">(</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">JSON</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">toJSONString</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">(hotelDoc), </span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">XContentType</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">JSON</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">));</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#6A9955;--shiki-dark:#6A9955;">    // 3.发送请求</span></span>
<span class="line"><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">    restHighLevelClient</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">bulk</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">(request, </span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">RequestOptions</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">DEFAULT</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">提示</p><p>通过循环的方式将多个<code>xxxRequest</code>放入到<code>BulkRequest</code>中</p></div>`,40),d=[r];function c(t,k){return a(),n("div",null,d)}const h=s(p,[["render",c],["__file","Doc-Java.html.vue"]]),y=JSON.parse('{"path":"/Use/Java/ElasticSearch/Doc-Java.html","title":"文档操作-Java","lang":"zh-CN","frontmatter":{"order":5,"category":"使用篇"},"headers":[{"level":2,"title":"一、新增文档","slug":"一、新增文档","link":"#一、新增文档","children":[]},{"level":2,"title":"二、查询文档","slug":"二、查询文档","link":"#二、查询文档","children":[]},{"level":2,"title":"三、删除文档","slug":"三、删除文档","link":"#三、删除文档","children":[]},{"level":2,"title":"四、修改文档","slug":"四、修改文档","link":"#四、修改文档","children":[]},{"level":2,"title":"五、批量导入文档","slug":"五、批量导入文档","link":"#五、批量导入文档","children":[]}],"git":{"createdTime":1708330205000,"updatedTime":1708873062000,"contributors":[{"name":"zhanglinwei","email":"3498729975@qq.com","commits":2}]},"readingTime":{"minutes":2.87,"words":860},"filePathRelative":"Use/Java/ElasticSearch/Doc-Java.md","localizedDate":"2024年2月19日"}');export{h as comp,y as data};
