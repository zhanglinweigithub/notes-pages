import{_ as o,r as D,o as c,c as d,g as t,w as a,a as n,f as i,e as s}from"./app-Vg0IViah.js";const k="/notes-pages/assets/dd8d7822b5fce5bbcf1ef7e509dd560-D8hHV4uD.png",p="/notes-pages/assets/image-20240308154436457-Jsz-c7ah.png",h={},C=n('<h1 id="shiro监听seesion事件" tabindex="-1"><a class="header-anchor" href="#shiro监听seesion事件"><span>Shiro监听Seesion事件</span></a></h1><p>要监听<code>Shiro</code>的<code>Session</code>事件，需要实现自己的<code>SessionManager</code></p><h2 id="一、配置" tabindex="-1"><a class="header-anchor" href="#一、配置"><span>一、配置</span></a></h2><ol><li>自定义类，实现<code>shiro</code>的<code>SessionListener</code>接口</li><li>在<code>SessionManager</code>中传入自定义的<code>SessionListener</code></li></ol>',4),y=s("div",{class:"language-java line-numbers-mode","data-ext":"java","data-title":"java"},[s("pre",{class:"shiki shiki-themes dark-plus dark-plus",style:{"background-color":"#1E1E1E","--shiki-dark-bg":"#1E1E1E",color:"#D4D4D4","--shiki-dark":"#D4D4D4"},tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4","--shiki-dark":"#D4D4D4"}},"@"),s("span",{style:{color:"#4EC9B0","--shiki-dark":"#4EC9B0"}},"Configuration")]),i(`
`),s("span",{class:"line"},[s("span",{style:{color:"#569CD6","--shiki-dark":"#569CD6"}},"public"),s("span",{style:{color:"#569CD6","--shiki-dark":"#569CD6"}}," class"),s("span",{style:{color:"#4EC9B0","--shiki-dark":"#4EC9B0"}}," ShiroConfig"),s("span",{style:{color:"#D4D4D4","--shiki-dark":"#D4D4D4"}}," {")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{color:"#6A9955","--shiki-dark":"#6A9955"}},"    /**")]),i(`
`),s("span",{class:"line"},[s("span",{style:{color:"#6A9955","--shiki-dark":"#6A9955"}},"     * 自定义sessionManager")]),i(`
`),s("span",{class:"line"},[s("span",{style:{color:"#6A9955","--shiki-dark":"#6A9955"}},"     *  1、添加session监听器")]),i(`
`),s("span",{class:"line"},[s("span",{style:{color:"#6A9955","--shiki-dark":"#6A9955"}},"     * "),s("span",{style:{color:"#569CD6","--shiki-dark":"#569CD6"}},"@return")]),i(`
`),s("span",{class:"line"},[s("span",{style:{color:"#6A9955","--shiki-dark":"#6A9955"}},"     */")]),i(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4","--shiki-dark":"#D4D4D4"}},"    @"),s("span",{style:{color:"#4EC9B0","--shiki-dark":"#4EC9B0"}},"Bean")]),i(`
`),s("span",{class:"line"},[s("span",{style:{color:"#569CD6","--shiki-dark":"#569CD6"}},"    public"),s("span",{style:{color:"#4EC9B0","--shiki-dark":"#4EC9B0"}}," DefaultWebSessionManager"),s("span",{style:{color:"#DCDCAA","--shiki-dark":"#DCDCAA"}}," sessionManager"),s("span",{style:{color:"#D4D4D4","--shiki-dark":"#D4D4D4"}},"() {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{color:"#4EC9B0","--shiki-dark":"#4EC9B0"}},"        DefaultWebSessionManager"),s("span",{style:{color:"#9CDCFE","--shiki-dark":"#9CDCFE"}}," sessionManager"),s("span",{style:{color:"#D4D4D4","--shiki-dark":"#D4D4D4"}}," = "),s("span",{style:{color:"#C586C0","--shiki-dark":"#C586C0"}},"new"),s("span",{style:{color:"#DCDCAA","--shiki-dark":"#DCDCAA"}}," DefaultWebSessionManager"),s("span",{style:{color:"#D4D4D4","--shiki-dark":"#D4D4D4"}},"();")]),i(`
`),s("span",{class:"line"},[s("span",{style:{color:"#9CDCFE","--shiki-dark":"#9CDCFE"}},"        sessionManager"),s("span",{style:{color:"#D4D4D4","--shiki-dark":"#D4D4D4"}},"."),s("span",{style:{color:"#DCDCAA","--shiki-dark":"#DCDCAA"}},"setSessionListeners"),s("span",{style:{color:"#D4D4D4","--shiki-dark":"#D4D4D4"}},"("),s("span",{style:{color:"#9CDCFE","--shiki-dark":"#9CDCFE"}},"Collections"),s("span",{style:{color:"#D4D4D4","--shiki-dark":"#D4D4D4"}},"."),s("span",{style:{color:"#DCDCAA","--shiki-dark":"#DCDCAA"}},"singleton"),s("span",{style:{color:"#D4D4D4","--shiki-dark":"#D4D4D4"}},"("),s("span",{style:{color:"#C586C0","--shiki-dark":"#C586C0"}},"new"),s("span",{style:{color:"#DCDCAA","--shiki-dark":"#DCDCAA"}}," CustomSessionListener"),s("span",{style:{color:"#D4D4D4","--shiki-dark":"#D4D4D4"}},"()));")]),i(`
`),s("span",{class:"line"},[s("span",{style:{color:"#C586C0","--shiki-dark":"#C586C0"}},"        return"),s("span",{style:{color:"#D4D4D4","--shiki-dark":"#D4D4D4"}}," sessionManager;")]),i(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4","--shiki-dark":"#D4D4D4"}},"    }")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4","--shiki-dark":"#D4D4D4"}},"}")]),i(`
`),s("span",{class:"line"})])]),s("div",{class:"highlight-lines"},[s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("div",{class:"highlight-line"}," "),s("div",{class:"highlight-line"}," "),s("div",{class:"highlight-line"}," "),s("div",{class:"highlight-line"}," "),s("div",{class:"highlight-line"}," "),s("div",{class:"highlight-line"}," "),s("div",{class:"highlight-line"}," "),s("div",{class:"highlight-line"}," ")]),s("div",{class:"line-numbers","aria-hidden":"true"},[s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"})])],-1),u=s("div",{class:"language-java line-numbers-mode","data-ext":"java","data-title":"java"},[s("pre",{class:"shiki shiki-themes dark-plus dark-plus",style:{"background-color":"#1E1E1E","--shiki-dark-bg":"#1E1E1E",color:"#D4D4D4","--shiki-dark":"#D4D4D4"},tabindex:"0"},[s("code",null,[s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4","--shiki-dark":"#D4D4D4"}},"@"),s("span",{style:{color:"#4EC9B0","--shiki-dark":"#4EC9B0"}},"Slf4j")]),i(`
`),s("span",{class:"line"},[s("span",{style:{color:"#569CD6","--shiki-dark":"#569CD6"}},"public"),s("span",{style:{color:"#569CD6","--shiki-dark":"#569CD6"}}," class"),s("span",{style:{color:"#4EC9B0","--shiki-dark":"#4EC9B0"}}," CustomSessionListener"),s("span",{style:{color:"#569CD6","--shiki-dark":"#569CD6"}}," implements"),s("span",{style:{color:"#4EC9B0","--shiki-dark":"#4EC9B0"}}," SessionListener"),s("span",{style:{color:"#D4D4D4","--shiki-dark":"#D4D4D4"}}," {")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4","--shiki-dark":"#D4D4D4"}},"    @"),s("span",{style:{color:"#4EC9B0","--shiki-dark":"#4EC9B0"}},"Autowired")]),i(`
`),s("span",{class:"line"},[s("span",{style:{color:"#569CD6","--shiki-dark":"#569CD6"}},"    private"),s("span",{style:{color:"#4EC9B0","--shiki-dark":"#4EC9B0"}}," SessionContext"),s("span",{style:{color:"#9CDCFE","--shiki-dark":"#9CDCFE"}}," sessionContext"),s("span",{style:{color:"#D4D4D4","--shiki-dark":"#D4D4D4"}},";")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{color:"#6A9955","--shiki-dark":"#6A9955"}},"    /**")]),i(`
`),s("span",{class:"line"},[s("span",{style:{color:"#6A9955","--shiki-dark":"#6A9955"}},"     * 会话创建时调用，也就是登录时")]),i(`
`),s("span",{class:"line"},[s("span",{style:{color:"#6A9955","--shiki-dark":"#6A9955"}},"     */")]),i(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4","--shiki-dark":"#D4D4D4"}},"    @"),s("span",{style:{color:"#4EC9B0","--shiki-dark":"#4EC9B0"}},"Override")]),i(`
`),s("span",{class:"line"},[s("span",{style:{color:"#569CD6","--shiki-dark":"#569CD6"}},"    public"),s("span",{style:{color:"#4EC9B0","--shiki-dark":"#4EC9B0"}}," void"),s("span",{style:{color:"#DCDCAA","--shiki-dark":"#DCDCAA"}}," onStart"),s("span",{style:{color:"#D4D4D4","--shiki-dark":"#D4D4D4"}},"("),s("span",{style:{color:"#4EC9B0","--shiki-dark":"#4EC9B0"}},"Session"),s("span",{style:{color:"#9CDCFE","--shiki-dark":"#9CDCFE"}}," session"),s("span",{style:{color:"#D4D4D4","--shiki-dark":"#D4D4D4"}},") {")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4","--shiki-dark":"#D4D4D4"}},"    }")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{color:"#6A9955","--shiki-dark":"#6A9955"}},"    /**")]),i(`
`),s("span",{class:"line"},[s("span",{style:{color:"#6A9955","--shiki-dark":"#6A9955"}},"     * 登出时调用")]),i(`
`),s("span",{class:"line"},[s("span",{style:{color:"#6A9955","--shiki-dark":"#6A9955"}},"     */")]),i(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4","--shiki-dark":"#D4D4D4"}},"    @"),s("span",{style:{color:"#4EC9B0","--shiki-dark":"#4EC9B0"}},"Override")]),i(`
`),s("span",{class:"line"},[s("span",{style:{color:"#569CD6","--shiki-dark":"#569CD6"}},"    public"),s("span",{style:{color:"#4EC9B0","--shiki-dark":"#4EC9B0"}}," void"),s("span",{style:{color:"#DCDCAA","--shiki-dark":"#DCDCAA"}}," onStop"),s("span",{style:{color:"#D4D4D4","--shiki-dark":"#D4D4D4"}},"("),s("span",{style:{color:"#4EC9B0","--shiki-dark":"#4EC9B0"}},"Session"),s("span",{style:{color:"#9CDCFE","--shiki-dark":"#9CDCFE"}}," session"),s("span",{style:{color:"#D4D4D4","--shiki-dark":"#D4D4D4"}},") {")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4","--shiki-dark":"#D4D4D4"}},"    }")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{color:"#6A9955","--shiki-dark":"#6A9955"}},"    /**")]),i(`
`),s("span",{class:"line"},[s("span",{style:{color:"#6A9955","--shiki-dark":"#6A9955"}},"     * session过期时调用")]),i(`
`),s("span",{class:"line"},[s("span",{style:{color:"#6A9955","--shiki-dark":"#6A9955"}},"     */")]),i(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4","--shiki-dark":"#D4D4D4"}},"    @"),s("span",{style:{color:"#4EC9B0","--shiki-dark":"#4EC9B0"}},"Override")]),i(`
`),s("span",{class:"line"},[s("span",{style:{color:"#569CD6","--shiki-dark":"#569CD6"}},"    public"),s("span",{style:{color:"#4EC9B0","--shiki-dark":"#4EC9B0"}}," void"),s("span",{style:{color:"#DCDCAA","--shiki-dark":"#DCDCAA"}}," onExpiration"),s("span",{style:{color:"#D4D4D4","--shiki-dark":"#D4D4D4"}},"("),s("span",{style:{color:"#4EC9B0","--shiki-dark":"#4EC9B0"}},"Session"),s("span",{style:{color:"#9CDCFE","--shiki-dark":"#9CDCFE"}}," session"),s("span",{style:{color:"#D4D4D4","--shiki-dark":"#D4D4D4"}},") {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4","--shiki-dark":"#D4D4D4"}},"        ")]),i(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4","--shiki-dark":"#D4D4D4"}},"    }")]),i(`
`),s("span",{class:"line"},[s("span",{style:{color:"#D4D4D4","--shiki-dark":"#D4D4D4"}},"}")]),i(`
`),s("span",{class:"line"})])]),s("div",{class:"line-numbers","aria-hidden":"true"},[s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"})])],-1),b=n('<h2 id="二、注意事项" tabindex="-1"><a class="header-anchor" href="#二、注意事项"><span>二、注意事项</span></a></h2><ol><li><code>onStart</code>：无法从<code>session</code>中获取相关信息，因为还没存</li></ol><figure><img src="'+k+'" alt="dd8d7822b5fce5bbcf1ef7e509dd560" tabindex="0" loading="lazy"><figcaption>dd8d7822b5fce5bbcf1ef7e509dd560</figcaption></figure><ol start="2"><li><code>onStop</code>：无法从<code>session</code>中获取相关信息，因为是先注销再通知</li></ol><figure><img src="'+p+`" alt="image-20240308154436457" tabindex="0" loading="lazy"><figcaption>image-20240308154436457</figcaption></figure><ol start="3"><li><code>onExpiration</code>：可以从<code>session</code>中获取相关信息，可以Debug看一下对应的key</li></ol><p>如果有多个Realm要注意指定对应的Realm，否则可能出现获取到的信息不对的问题</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes dark-plus dark-plus" style="background-color:#1E1E1E;--shiki-dark-bg:#1E1E1E;color:#D4D4D4;--shiki-dark:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#4EC9B0;--shiki-dark:#4EC9B0;">PrincipalCollection</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;"> principalCollection</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> = (PrincipalCollection) </span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">session</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">getAttribute</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">(</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">DefaultSubjectContext</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">PRINCIPALS_SESSION_KEY</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#4EC9B0;--shiki-dark:#4EC9B0;">        UserPrincipal</span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;"> principal</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> = (UserPrincipal) </span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">principalCollection</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">.</span><span style="color:#DCDCAA;--shiki-dark:#DCDCAA;">getPrimaryPrincipal</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">();</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>getPrimaryPrincipal()</code>：会返回第一个，但是因为是Hash存储，就相当于是随机的。如果只有一个Realm可以这么用</li></ul>`,9);function m(v,E){const r=D("CodeTabs");return c(),d("div",null,[C,t(r,{id:"21",data:[{id:"ShiroConfig"},{id:"CustomSessionListener"}]},{title0:a(({value:l,isActive:e})=>[i("ShiroConfig")]),title1:a(({value:l,isActive:e})=>[i("CustomSessionListener")]),tab0:a(({value:l,isActive:e})=>[y]),tab1:a(({value:l,isActive:e})=>[u]),_:1}),b])}const A=o(h,[["render",m],["__file","SessionListener.html.vue"]]),B=JSON.parse('{"path":"/Use/Java/Shiro/SessionListener.html","title":"Shiro监听Seesion事件","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"一、配置","slug":"一、配置","link":"#一、配置","children":[]},{"level":2,"title":"二、注意事项","slug":"二、注意事项","link":"#二、注意事项","children":[]}],"git":{"createdTime":1709884236000,"updatedTime":1709884236000,"contributors":[{"name":"zhanglinwei","email":"3498729975@qq.com","commits":1}]},"readingTime":{"minutes":1,"words":299},"filePathRelative":"Use/Java/Shiro/SessionListener.md","localizedDate":"2024年3月8日"}');export{A as comp,B as data};
