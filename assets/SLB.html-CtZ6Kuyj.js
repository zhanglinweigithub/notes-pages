import{_ as s,o as a,c as n,a as i}from"./app-Vg0IViah.js";const l={},e=i(`<h1 id="配置负载均衡" tabindex="-1"><a class="header-anchor" href="#配置负载均衡"><span>配置负载均衡</span></a></h1><h2 id="一、策略" tabindex="-1"><a class="header-anchor" href="#一、策略"><span>一、策略</span></a></h2><table><thead><tr><th style="text-align:left;">负载策略</th><th style="text-align:left;">描述</th><th style="text-align:left;">特点</th></tr></thead><tbody><tr><td style="text-align:left;">轮询</td><td style="text-align:left;">默认方式</td><td style="text-align:left;">1. 每个请求会按时间顺序逐一分配到不同的后端服务器 <br>2. 在轮询中，如果服务器<code>down</code>掉了，会自动剔除该服务器 <br>3. 缺省配置就是轮询策略 <br>4. 此策略适合服务器配置相当，无状态且短平快的服务使用</td></tr><tr><td style="text-align:left;">weight</td><td style="text-align:left;">权重方式</td><td style="text-align:left;">1. 在轮询策略的基础上指定轮询的几率 <br>2. 权重越高分配到的请求越多 <br>3. 此策略可以与<code>least_conn</code>和<code>ip_hash</code>结合使用 <br>4. 此策略比较适合服务器的硬件配置差别比较大的情况</td></tr><tr><td style="text-align:left;">ip_hash</td><td style="text-align:left;">依据ip的hash值来分配</td><td style="text-align:left;">1. 在<code>nginx</code>版本1.3.1之前，不能在<code>ip_hash</code>中使用权重（weight） <br>2. <code>ip_hash</code>不能与<code>backup</code>同时使用 <br>3. 此策略适合有状态服务，比如<code>session</code> <br>4. 当有服务器需要剔除，必须手动<code>down</code>掉</td></tr><tr><td style="text-align:left;">least_conn</td><td style="text-align:left;">最少连接方式</td><td style="text-align:left;">1. 此负载均衡策略适合请求处理时间长短不一造成服务器过载的情况</td></tr><tr><td style="text-align:left;">fair（第三方）</td><td style="text-align:left;">响应时间方式</td><td style="text-align:left;">1. 根据后端服务器的响应时间来分配请求，响应时间短的优先分配 <br>2. <code>Nginx</code>本身不支持<code>fair</code>，如果需要这种调度算法，则必须安装<code>upstream_fair</code>模块</td></tr><tr><td style="text-align:left;">url_hash（第三方）</td><td style="text-align:left;">依据URL分配方式</td><td style="text-align:left;">1. 按访问的<code>URL</code>的哈希结果来分配请求，使每个<code>URL</code>定向到一台后端服务器<br> 2. <code>Nginx</code>本身不支持<code>url_hash</code>，如果需要这种调度算法，则必须安装<code>Nginx</code>的<code>hash</code>软件包</td></tr></tbody></table><h2 id="二、配置" tabindex="-1"><a class="header-anchor" href="#二、配置"><span>二、配置</span></a></h2><h3 id="_1、轮询" tabindex="-1"><a class="header-anchor" href="#_1、轮询"><span>1、轮询</span></a></h3><div class="language-nginx line-numbers-mode" data-ext="nginx" data-title="nginx"><pre class="shiki shiki-themes dark-plus dark-plus" style="background-color:#1E1E1E;--shiki-dark-bg:#1E1E1E;color:#D4D4D4;--shiki-dark:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#569CD6;--shiki-dark:#569CD6;">http</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">    </span></span>
<span class="line"><span style="color:#569CD6;--shiki-dark:#569CD6;">    upstream</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> my-server {</span></span>
<span class="line"><span style="color:#569CD6;--shiki-dark:#569CD6;">        server</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> 127.0.0.1:8190;</span></span>
<span class="line"><span style="color:#569CD6;--shiki-dark:#569CD6;">        server</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> 127.0.0.2:8190;</span></span>
<span class="line"><span style="color:#569CD6;--shiki-dark:#569CD6;">        server</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> 127.0.0.3:8190;</span></span>
<span class="line"><span style="color:#6A9955;--shiki-dark:#6A9955;">        # ...</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">	}</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">    </span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">    server{</span></span>
<span class="line"><span style="color:#569CD6;--shiki-dark:#569CD6;">		listen </span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">80;</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">	</span></span>
<span class="line"><span style="color:#569CD6;--shiki-dark:#569CD6;">        location</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> /vueAdmin {</span></span>
<span class="line"><span style="color:#569CD6;--shiki-dark:#569CD6;">			proxy_pass </span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">http://my-server; </span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">        }</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">        </span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2、weight" tabindex="-1"><a class="header-anchor" href="#_2、weight"><span>2、weight</span></a></h3><p><code>weight</code>的默认值为1，数值越大访问频率越高</p><div class="language-nginx line-numbers-mode" data-ext="nginx" data-title="nginx"><pre class="shiki shiki-themes dark-plus dark-plus" style="background-color:#1E1E1E;--shiki-dark-bg:#1E1E1E;color:#D4D4D4;--shiki-dark:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#569CD6;--shiki-dark:#569CD6;">http</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">    </span></span>
<span class="line"><span style="color:#569CD6;--shiki-dark:#569CD6;">    upstream</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> my-server {</span></span>
<span class="line"><span style="color:#569CD6;--shiki-dark:#569CD6;">        server</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> 127.0.0.1:8190;</span></span>
<span class="line"><span style="color:#569CD6;--shiki-dark:#569CD6;">        server</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> 127.0.0.2:8190 </span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">weight</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">=</span><span style="color:#B5CEA8;--shiki-dark:#B5CEA8;">10</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">        server 127.0.0.3:8190;</span></span>
<span class="line"><span style="color:#6A9955;--shiki-dark:#6A9955;">        # ...</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">	}</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">    </span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">    server{</span></span>
<span class="line"><span style="color:#569CD6;--shiki-dark:#569CD6;">		listen </span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">80;</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">	</span></span>
<span class="line"><span style="color:#569CD6;--shiki-dark:#569CD6;">        location</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> /vueAdmin {</span></span>
<span class="line"><span style="color:#569CD6;--shiki-dark:#569CD6;">			proxy_pass </span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">http://my-server; </span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">        }</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">        </span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3、ip-hash" tabindex="-1"><a class="header-anchor" href="#_3、ip-hash"><span>3、ip_hash</span></a></h3><p>在<code>upstream</code>中指定 <code>ip_hash;</code>即可</p><div class="language-nginx line-numbers-mode" data-ext="nginx" data-title="nginx"><pre class="shiki shiki-themes dark-plus dark-plus" style="background-color:#1E1E1E;--shiki-dark-bg:#1E1E1E;color:#D4D4D4;--shiki-dark:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#569CD6;--shiki-dark:#569CD6;">http</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">    </span></span>
<span class="line"><span style="color:#569CD6;--shiki-dark:#569CD6;">    upstream</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> my-server {</span></span>
<span class="line"><span style="color:#569CD6;--shiki-dark:#569CD6;">        ip_hash</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">; </span><span style="color:#6A9955;--shiki-dark:#6A9955;"># 这里</span></span>
<span class="line"><span style="color:#569CD6;--shiki-dark:#569CD6;">        server</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> 127.0.0.1:8190;</span></span>
<span class="line"><span style="color:#569CD6;--shiki-dark:#569CD6;">        server</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> 127.0.0.2:8190 </span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">weight</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">=</span><span style="color:#B5CEA8;--shiki-dark:#B5CEA8;">10</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">        server 127.0.0.3:8190;</span></span>
<span class="line"><span style="color:#6A9955;--shiki-dark:#6A9955;">        # ...</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">	}</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">    </span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">    server{</span></span>
<span class="line"><span style="color:#569CD6;--shiki-dark:#569CD6;">		listen </span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">80;</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">	</span></span>
<span class="line"><span style="color:#569CD6;--shiki-dark:#569CD6;">        location</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> /vueAdmin {</span></span>
<span class="line"><span style="color:#569CD6;--shiki-dark:#569CD6;">			proxy_pass </span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">http://my-server; </span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">        }</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">        </span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4、least-conn" tabindex="-1"><a class="header-anchor" href="#_4、least-conn"><span>4、least_conn</span></a></h3><p>最小连接数策略：把请求转发给连接数较少的后端服务器</p><p>在<code>upstream</code>中指定 <code>least_conn;</code>即可</p><div class="language-nginx line-numbers-mode" data-ext="nginx" data-title="nginx"><pre class="shiki shiki-themes dark-plus dark-plus" style="background-color:#1E1E1E;--shiki-dark-bg:#1E1E1E;color:#D4D4D4;--shiki-dark:#D4D4D4;" tabindex="0"><code><span class="line"><span style="color:#569CD6;--shiki-dark:#569CD6;">http</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">    </span></span>
<span class="line"><span style="color:#569CD6;--shiki-dark:#569CD6;">    upstream</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> my-server {</span></span>
<span class="line"><span style="color:#569CD6;--shiki-dark:#569CD6;">        least_conn</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">; </span><span style="color:#6A9955;--shiki-dark:#6A9955;"># 这里</span></span>
<span class="line"><span style="color:#569CD6;--shiki-dark:#569CD6;">        server</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> 127.0.0.1:8190;</span></span>
<span class="line"><span style="color:#569CD6;--shiki-dark:#569CD6;">        server</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> 127.0.0.2:8190 </span><span style="color:#9CDCFE;--shiki-dark:#9CDCFE;">weight</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">=</span><span style="color:#B5CEA8;--shiki-dark:#B5CEA8;">10</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">;</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">        server 127.0.0.3:8190;</span></span>
<span class="line"><span style="color:#6A9955;--shiki-dark:#6A9955;">        # ...</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">	}</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">    </span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">    server{</span></span>
<span class="line"><span style="color:#569CD6;--shiki-dark:#569CD6;">		listen </span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">80;</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">	</span></span>
<span class="line"><span style="color:#569CD6;--shiki-dark:#569CD6;">        location</span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;"> /vueAdmin {</span></span>
<span class="line"><span style="color:#569CD6;--shiki-dark:#569CD6;">			proxy_pass </span><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">http://my-server; </span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">        }</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">        </span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;--shiki-dark:#D4D4D4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,16),D=[e];function r(p,d){return a(),n("div",null,D)}const c=s(l,[["render",r],["__file","SLB.html.vue"]]),o=JSON.parse('{"path":"/Use/Java/Nginx/SLB.html","title":"配置负载均衡","lang":"zh-CN","frontmatter":{"category":"使用篇"},"headers":[{"level":2,"title":"一、策略","slug":"一、策略","link":"#一、策略","children":[]},{"level":2,"title":"二、配置","slug":"二、配置","link":"#二、配置","children":[{"level":3,"title":"1、轮询","slug":"_1、轮询","link":"#_1、轮询","children":[]},{"level":3,"title":"2、weight","slug":"_2、weight","link":"#_2、weight","children":[]},{"level":3,"title":"3、ip_hash","slug":"_3、ip-hash","link":"#_3、ip-hash","children":[]},{"level":3,"title":"4、least_conn","slug":"_4、least-conn","link":"#_4、least-conn","children":[]}]}],"git":{"createdTime":1708330205000,"updatedTime":1708873062000,"contributors":[{"name":"zhanglinwei","email":"3498729975@qq.com","commits":2}]},"readingTime":{"minutes":2.07,"words":620},"filePathRelative":"Use/Java/Nginx/SLB.md","localizedDate":"2024年2月19日"}');export{c as comp,o as data};
